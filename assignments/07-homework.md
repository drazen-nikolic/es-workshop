# Homework

## Working with Elasticsearch via Java Client

The goal of this final workshop assignments is to make a simple application which utilizes
Elasticsearch and its features via Java Client.

The test project is based on [Spring Boot](https://projects.spring.io/spring-boot/) and 
[Spring Data Elasticsearch](https://projects.spring.io/spring-data-elasticsearch/).

*For more details about Spring Data project and how to use it with Elasticsearch, check
[Documentation](https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/). Note that 
Chapter 1. "Working with Spring Data Repositories"is a general description about Spring Data
project abstraction, while [Chapter 2. "Elasticsearch Repositories"](https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#reference) 
is a reference documentation for Spring Data Elasticsearch project.*

*Hint: [Introduction to Spring Data Elasticsearch](http://www.baeldung.com/spring-data-elasticsearch-tutorial)
from bealdung.com can help you in implementation, too.*

## The Search Feature for a Company Messaging Portal

Your company has implemented an official company messaging portal, where colleagues can
login and send messages. All sent messages are stored in a relation database in a table 
`user_messages`

|field_name|type|
|--------|-------|
|id|long (PK)|
|username|varchar|
|message_text|text|
|time|timestamp|

Your task is to implement Full-text Search Feature for this company portal. 

### Requirements

1  
Users should be able to search messages by username as: give me all messages this user has sent
in the given period (date-from, date-to). Dates will be sent as text in a ISO 8601 format, like: "2017-12-25".

2  
Users should be able to search `messages_text` by an arbitrary string - give me all messages containing 
a specific "search text" in a message text.   
The search should be "full-text" search and consider different word forms, synonyms etc.  
**All messages are written in English.  **

If there are multiple words in the "search text", match all messages containing at least one word. 
Additionally, messages containing the exact phrase should be positioned at the top of the search result.


### Test Project Description

The test project is a maven project. Main technology used is Spring Boot. 
Elasticsearch client is *Spring Data Elasticsearch*. 

The package structure is next:
* `com.seavus.workshop.elasticsearch.messaging` -  The "main" application, 
Massaging system, which stores the data to the relational database (by using Spring Data JPA).  
What you're interested here is to see `Message` domain entity and `MessageService` interface
providing a method to get all the messages from the database. You will need this when
reindxing data to Elasticsearch.
* `com.seavus.workshop.elasticsearch.search` -  The module you have to implement.

*Note: The test project is using Lombok, so you have to enable/install Lombok
for your IDE, if needed. See [here](https://projectlombok.org/setup/eclipse) for Eclipse configuration or
install this [plugin](https://plugins.jetbrains.com/plugin/6317-lombok-plugin) for Intellij IDEA.*

#### Validating Your Code Changes

There are unit tests in place and a sample database data. Your tasks is to practice TDD 
(Test Driven Development) and go fix test by test by updating/adding the code in the 
`search` module. At the end all tests should pass. 

Follow details instructions in the sections below. 

#### Part 1 - Indexing of Messages

Implement the logic for reindexing the messages from the relational database into Elasticsearch.

Analyze data types and how each field should be mapped in Elasticsearch index.

Note also that the search requirements consider searching messages by time in a "resolution" of a single day,
so index time information accordingly. 

IMPORTANT:
Since the official Release of Spring Data Elasticsearch is using old version of Elsticsearch
you'll have to use old field types. 

|new|old|
|---|---|
|field type: `keyword`|field type: `string`; index=`not_analyzed`|
|field type: `text`|field type: `string`; index=`analyzed`|

**What do to:**   

1. Open `IndexMessage` class and populate proper `@Field` annotation attributes 
for each field.
1. Run `ReindexTest`. No test should pass (all tests are red).
1. Implement `SearchImpl.reindex()` method which should load all messages from the 
relational database and index them in Elasticsearch
1. Repeat running `ReindexTest` and fixing code in `SearchImpl` until all tests pass
(all tests are green).

*Hint: If you change IndexMessage mapping, you'll need to manually delete `data` folder
which is autogenerated Elasticsearch index folder.*

#### Part 2 - Search by Username and Date Period

Implement the logic for searching by given username and date period (date-from, date-to). 

*Note that search should do an exact match on username.*

**What do to:**   
1. Run `SearchUserTest`. No test should pass (all tests are red).
1. Implement `SearchImpl.searchByUsername()` method body
1. Repeat running `SearchUserTest` and fixing code in `SearchImpl` until all tests pass
(all tests are green).

#### Part 3 - Full-text Search Within Messages Text

Implement the logic which will execute the full-text search in `message_text` field by the given search word 
or phrase (two or more words, separated by space character).

Note that search query should take care that messages having the exact search phrase are more relevant
than messages containing only a single word. 

**What do to:**   
1. Run `SearchMessagesTest`. No test should pass (all tests are red).
1. Implement `SearchImpl.searchMessageTexts()` method body
1. Repeat running `SearchMessagesTest` and fixing code in `SearchImpl` until all tests pass
(all tests are green). 

IMPORTANT: Do not use wildcards (*) in a query.

When all steps are finished, run again all tests. All should pass.




